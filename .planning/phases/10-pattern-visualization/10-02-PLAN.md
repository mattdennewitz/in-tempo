---
phase: 10-pattern-visualization
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - src/components/ScoreOverview.tsx
  - src/App.tsx
autonomous: false

must_haves:
  truths:
    - "A grid/matrix below the performer cards shows all performers' positions across the pattern sequence"
    - "Each performer's current pattern position is marked with a filled cell"
    - "Canon mode shows all 53 columns upfront; Euclidean/Generative modes grow progressively"
    - "The grid auto-scrolls to keep the leading performer(s) visible"
    - "The grid is always visible and not collapsible"
  artifacts:
    - path: "src/components/ScoreOverview.tsx"
      provides: "Score overview grid component"
      contains: "ScoreOverview"
    - path: "src/App.tsx"
      provides: "ScoreOverview wired into main layout"
      contains: "ScoreOverview"
  key_links:
    - from: "src/App.tsx"
      to: "src/components/ScoreOverview.tsx"
      via: "renders ScoreOverview with performers, totalPatterns, scoreMode props"
      pattern: "<ScoreOverview"
    - from: "src/components/ScoreOverview.tsx"
      to: "src/audio/types.ts"
      via: "imports PerformerState and ScoreMode types for props"
      pattern: "import.*PerformerState"
---

<objective>
Create the score overview grid/matrix visualization showing all performers' positions across the full pattern sequence, placed below the performer cards.

Purpose: VIZ-03 -- reveal canonic phasing and convergence through a grid where rows = performers, columns = patterns, and filled cells mark current positions.
Output: ScoreOverview component wired into the main layout, always visible below performer cards.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-pattern-visualization/10-CONTEXT.md
@.planning/phases/10-pattern-visualization/10-RESEARCH.md
@.planning/phases/10-pattern-visualization/10-01-SUMMARY.md

@src/App.tsx
@src/audio/types.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScoreOverview grid component</name>
  <files>src/components/ScoreOverview.tsx</files>
  <action>
Create `src/components/ScoreOverview.tsx` with these specifications per user decisions:

**Props interface:**
```typescript
interface ScoreOverviewProps {
  performers: PerformerState[];
  totalPatterns: number;
  scoreMode: ScoreMode;
  playing: boolean;
}
```

**Grid layout (per decisions):**
- Rows = performers (one row per active performer in the `performers` array)
- Columns = patterns (number determined by mode)
- Use CSS Grid with `grid-template-columns: auto repeat(N, size)` where auto is for row labels
- Fixed cell size (use ~`w-3 h-3` or `w-2.5 h-2.5` -- Claude's discretion on exact dimensions)
- Gap between cells: `gap-px` or `gap-0.5` (Claude's discretion)

**Column count logic (per decisions):**
- Canon mode (`riley`): always show all `totalPatterns` columns (53)
- Euclidean/Generative modes: show columns up to `Math.max(...performers.map(p => p.currentPattern), 1)` -- grows progressively as performers discover new patterns
- Minimum 1 column always visible

**Cell rendering (per decisions):**
- Each cell: filled (`bg-foreground`) if performer's `currentPattern === colIndex + 1`, otherwise `bg-muted`
- Monochrome color scheme -- single color for all performers per decision
- `transition-colors duration-150` on cells per decision (~150ms transition)
- `rounded-sm` for subtle rounding

**Row labels:**
- Left column shows performer label (e.g. "P1", "P2") in small text
- `text-[10px] text-muted-foreground` for labels

**Column labels (Claude's discretion):**
- Add a thin header row above the grid showing pattern numbers every 10th column (10, 20, 30, 40, 50) for orientation
- Use `text-[9px] text-muted-foreground` for column headers

**Scrolling (per decisions):**
- Container has `overflow-x-auto` for horizontal scrolling when grid exceeds viewport
- Auto-scroll: use a `useEffect` that runs when the leading performer's `currentPattern` changes. Find the cell element for the leading pattern position and call `scrollIntoView({ behavior: 'smooth', inline: 'end', block: 'nearest' })` on it.
- Only auto-scroll when `playing` is true (don't scroll on reset/stop)
- Use `data-col` attributes on cells to find the leading column's element
- To avoid fighting user scroll: only auto-scroll when pattern positions actually change (track `leadingCol` in the effect dependency, not every beat tick)

**Performance:**
- Wrap with `React.memo` to avoid re-renders when unrelated state changes
- The grid is max 53 columns x 16 rows = 848 cells -- no virtualization needed per research

**Empty state (before playback):**
- Show the grid frame with row labels and empty (`bg-muted`) cells matching the configured performers
- For Riley mode, show all 53 empty columns
- For other modes, show ~5 placeholder columns (or none -- Claude's discretion)
  </action>
  <verify>Run `npx tsc --noEmit` to verify the component compiles. Check that the component exports correctly.</verify>
  <done>ScoreOverview component renders a grid with rows=performers, columns=patterns. Filled cells mark current positions. Canon shows 53 columns upfront. Dynamic modes grow progressively. Auto-scroll keeps leading performers visible.</done>
</task>

<task type="auto">
  <name>Task 2: Wire ScoreOverview into App layout</name>
  <files>src/App.tsx</files>
  <action>
Modify `src/App.tsx` to add the ScoreOverview below the performer cards:

1. Import `ScoreOverview` from `./components/ScoreOverview.tsx`
2. Place `<ScoreOverview>` BELOW the existing `<PatternDisplay>` inside the `<main>` element
3. Adjust the main layout: the current `flex items-center justify-center` centers content vertically. Change to a column layout that puts PatternDisplay in the center area and ScoreOverview at the bottom. Consider using `flex flex-col items-center justify-center gap-6` or similar.
4. Pass required props:
   - `performers={engineState.performers}`
   - `totalPatterns={engineState.totalPatterns}`
   - `scoreMode={engineState.scoreMode}`
   - `playing={engineState.playing}`
5. The ScoreOverview should be always visible (not collapsible) per decision. It should span the full available width for the grid to have room.
6. Add a container for the ScoreOverview with `w-full max-w-4xl` or similar to constrain maximum width while allowing scrolling.

The ScoreOverview is placed below performer cards, always visible, and receives all data from the existing engineState.
  </action>
  <verify>Run `npx tsc --noEmit` for type checks. Run `npm run dev` and verify the grid appears below performer cards.</verify>
  <done>ScoreOverview is rendered below PatternDisplay in the App layout, receiving performers, totalPatterns, scoreMode, and playing from engine state. Always visible.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete visualization</name>
  <files>n/a</files>
  <action>
Human verifies the full pattern visualization system.

What was built: Note-hit dots on performer cards, pattern position display (X/Y), and score overview grid showing all performers' positions across the pattern sequence.

Verification steps:
1. Run `npm run dev` and open in browser
2. Before starting: verify the score overview grid appears below performer cards with empty cells
3. Start a Canon mode performance:
   - Verify dots flash on the left edge of performer cards in sync with audio
   - Verify dot intensity varies with velocity (some dots brighter than others)
   - Verify pattern position shows as "X/Y" (e.g. "1/53")
   - Verify the score overview grid shows filled cells at each performer's current pattern
   - Verify the staggered filled cells reveal canonic phasing (different performers at different positions)
   - Verify auto-scroll keeps the leading performer(s) visible as they advance
4. Try Euclidean mode: verify the grid starts small and grows as performers discover new patterns
5. Try Generative mode: same progressive growth behavior
6. Stop and reset: verify the grid returns to empty state
7. Add/remove performers: verify grid rows update accordingly
  </action>
  <verify>Type "approved" or describe issues</verify>
  <done>All three visualization layers verified working across all composition modes.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. Score overview grid visible below performer cards at all times
3. Grid rows match active performers, columns match pattern count
4. Canon mode: 53 columns visible from start
5. Euclidean/Generative: columns grow as performers advance
6. Filled cells correctly mark each performer's current pattern position
7. Auto-scroll keeps leading performers visible during playback
8. Grid cells use ~150ms transition when state changes
9. Monochrome color scheme (single color for all performers)
10. Grid is horizontally scrollable when it exceeds viewport width
</verification>

<success_criteria>
- VIZ-03 satisfied: score overview visualization shows all performers' positions across pattern sequence, revealing canonic phasing and convergence
- Grid works across all three composition modes
- Auto-scroll behavior is smooth and non-intrusive
- Layout integrates cleanly with existing performer cards
</success_criteria>

<output>
After completion, create `.planning/phases/10-pattern-visualization/10-02-SUMMARY.md`
</output>
