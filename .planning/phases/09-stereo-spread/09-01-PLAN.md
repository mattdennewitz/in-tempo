---
phase: 09-stereo-spread
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/audio/panner.ts
  - src/audio/panner.test.ts
autonomous: true

must_haves:
  truths:
    - "computePanPositions returns evenly-distributed values from -1 to +1"
    - "Single performer returns center (0)"
    - "Same seed produces identical pan position assignments"
    - "All positions are unique (no two performers share a pan value)"
  artifacts:
    - path: "src/audio/panner.ts"
      provides: "Pan position computation with seeded shuffle"
      exports: ["computePanPositions"]
    - path: "src/audio/panner.test.ts"
      provides: "Unit tests for pan position computation"
      min_lines: 40
  key_links:
    - from: "src/audio/panner.ts"
      to: "src/score/rng.ts"
      via: "SeededRng for deterministic shuffle"
      pattern: "import.*SeededRng.*from.*rng"
---

<objective>
TDD the pure pan position computation function that assigns each performer an evenly-distributed stereo position using a seeded shuffle.

Purpose: Foundation for stereo spread -- deterministic, evenly-spaced pan values that can be tested in isolation before wiring into the audio graph.
Output: `src/audio/panner.ts` with `computePanPositions()`, fully tested.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-stereo-spread/09-RESEARCH.md
@src/score/rng.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: TDD computePanPositions</name>
  <files>src/audio/panner.ts, src/audio/panner.test.ts</files>
  <action>
RED: Create `src/audio/panner.test.ts` with tests for `computePanPositions(count, rng)`:
- 1 performer: returns `[0]` (center)
- 2 performers: returns values containing -1 and +1 (hard left/right)
- 4 performers: returns 4 unique values, all in [-1, +1], evenly spaced slots are -1, -0.3333, 0.3333, 1
- Same seed produces same output (determinism)
- Different seeds produce different shuffle order
- All returned values are unique (no duplicates)
- Values span from approximately -1 to +1 (full stereo field used)

Import SeededRng from `src/score/rng.ts`.

GREEN: Create `src/audio/panner.ts` with:
```typescript
export function computePanPositions(count: number, rng: SeededRng): number[]
```

Algorithm:
1. If count === 1, return [0]
2. Generate evenly-spaced slots: `slot[i] = -1 + (2 * i) / (count - 1)`, rounded to 4 decimal places
3. Fisher-Yates shuffle the slots array using `rng.int(0, i)` for each index
4. Return the shuffled array (index = performer order, value = pan position)

REFACTOR if needed: ensure the function is clean, well-documented, and exported.

Run `npx vitest run src/audio/panner.test.ts` to confirm all tests pass.
  </action>
  <verify>npx vitest run src/audio/panner.test.ts -- all tests pass</verify>
  <done>computePanPositions returns deterministic, evenly-distributed, unique pan values for any performer count 1-16, verified by unit tests</done>
</task>

</tasks>

<verification>
- `npx vitest run src/audio/panner.test.ts` passes all tests
- Function handles edge cases: 1 performer (center), 2 performers (extremes), 16 performers (full spread)
- Determinism: same seed + same count = same output every time
</verification>

<success_criteria>
- computePanPositions is exported from src/audio/panner.ts
- All unit tests pass
- Function produces evenly-distributed, deterministic pan assignments
</success_criteria>

<output>
After completion, create `.planning/phases/09-stereo-spread/09-01-SUMMARY.md`
</output>
